def get_summary_prompt(paper_text):
    """논문 요약 프롬프트"""
    # 컨텍스트 길이 제한 (대략 4000자)
    max_length = 4000
    truncated_text = paper_text[:max_length] + "..." if len(paper_text) > max_length else paper_text
    
    return f"""
당신은 전문적인 연구 분석가입니다. 다음 논문 텍스트를 분석하여 한국어로 구조화된 요약을 작성해주세요.

**요약 형식:**
📋 **제목 및 개요**
- 논문의 주제와 핵심 연구 질문

🎯 **연구 목적 및 배경**
- 연구의 동기와 목적
- 관련 연구 및 배경

🔬 **연구 방법**
- 사용된 방법론과 실험 설계
- 데이터 수집 및 분석 방법

📊 **주요 결과**
- 핵심 발견사항과 결과
- 중요한 수치나 통계

💡 **결론 및 기여**
- 연구의 주요 기여도
- 한계점 및 향후 연구 방향

논문 텍스트:
{truncated_text}

요약:
"""

def get_debate_prompt(summary_text):
    """페르소나 토론 프롬프트"""
    return f"""
당신은 Town Hall Debate 스타일의 학술 토론을 시뮬레이션하는 시스템입니다.

다음 두 연구자 페르소나가 논문에 대해 토론합니다:

👤 **긍정연구자 (Dr. Hope)**: 
- 논문의 혁신성과 기여도를 강조
- 연구의 잠재적 영향력과 응용 가능성에 주목
- 긍정적이고 건설적인 관점 제시

👤 **비판연구자 (Dr. Critical)**:
- 방법론적 한계와 논리적 약점 지적
- 결과 해석의 신뢰성과 일반화 가능성 의문 제기
- 엄격하고 신중한 학술적 비판 제시

**토론 규칙:**
- 각 페르소나가 3턴씩 발언 (총 6턴)
- 서로의 논점에 대한 반박과 재반박 포함
- 학술적이고 전문적인 어조 유지

논문 요약:
{summary_text}

토론 시작:
[긍정연구자]: 
[비판연구자]: 
[긍정연구자]: 
[비판연구자]: 
[긍정연구자]: 
[비판연구자]: 
"""

def get_mediator_prompt(debate_text):
    """중재자 요약 프롬프트"""
    return f"""
당신은 객관적이고 균형잡힌 중재자 역할의 연구자입니다.

앞선 두 연구자의 토론을 바탕으로 논문에 대한 종합적인 평가를 제시해주세요.

토론 내용:
{debate_text}

⚖️ **중재자 종합 평가**

**🟢 주요 강점:**
1. 
2. 
3. 

**🔴 주요 약점:**
1. 
2. 
3. 

**📈 전반적 평가:**
(논문의 학술적 가치, 기여도, 한계점을 종합적으로 평가)

**🎯 추천 사항:**
(향후 연구 방향이나 개선점 제시)

---
💬 이제 논문의 전문용어나 세부 내용에 대해 질문해주세요. 
계속해서 대화하며 궁금한 점을 해결해드리겠습니다.
"""

def get_jargon_qa_prompt(user_query, retrieved_context, conversation_history=""):
    """Jargon Q&A 프롬프트 (멀티턴 대화 지원)"""
    history_context = ""
    if conversation_history:
        history_context = f"\n**이전 대화 맥락:**\n{conversation_history}\n"
    
    return f"""
당신은 친근하고 전문적인 중재자 연구자입니다. 사용자의 질문에 대해 명확하고 이해하기 쉽게 답변해주세요.

**검색된 용어 정의:**
{retrieved_context}
{history_context}
**사용자 질문:** {user_query}

**답변 가이드라인:**
- 전문용어는 쉬운 언어로 설명
- 구체적인 예시나 비유 활용
- 이전 대화 맥락 고려
- 추가 질문 유도

답변:
"""